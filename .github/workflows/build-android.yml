# .github/workflows/debug-build.yml
name: Debug Build

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install minimal deps
      run: |
        sudo apt-get update
        sudo apt-get install -y python3-pip git
        pip install buildozer

    - name: Test Buildozer
      run: |
        echo "=== Buildozer version ==="
        buildozer --version || echo "Buildozer not found"
        
        echo ""
        echo "=== Python version ==="
        python --version
        
        echo ""
        echo "=== Directory structure ==="
        ls -la
        
        echo ""
        echo "=== buildozer.spec exists? ==="
        if [ -f "buildozer.spec" ]; then
          echo "Yes"
          echo "First 20 lines:"
          head -20 buildozer.spec
        else
          echo "No - creating basic one"
          cat > buildozer.spec << EOF
[app]
title = Test App
package.name = testapp
package.domain = org.test
source.dir = .
source.include_exts = py,png,jpg,kv
version = 1.0
requirements = python3,kivy
orientation = portrait

[buildozer]
log_level = 2
warn_on_root = 0
EOF
        fi

    - name: Try Buildozer Init
      run: |
        echo "=== Running buildozer init ==="
        buildozer init 2>&1 | head -50
        
        echo ""
        echo "=== Checking .buildozer directory ==="
        ls -la .buildozer 2>/dev/null || echo ".buildozer not created"

    - name: Simple Build Test
      continue-on-error: true
      run: |
        echo "=== Trying simple build ==="
        # Just update to download dependencies
        timeout 600 buildozer android update 2>&1 | tail -50
